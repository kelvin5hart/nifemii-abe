(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85611,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),n=e.i(22016);e.i(36180);var i=e.i(98925),s=e.i(59141);function o(){let e=(0,r.useSearchParams)(),o=(0,r.useRouter)(),[c,d]=(0,a.useState)("loading"),[l,m]=(0,a.useState)(""),f=e.get("reference"),u=e.get("trxref"),p=f||u;return(0,a.useEffect)(()=>{(async()=>{if(!p){d("failed"),m("No payment reference found");return}try{let e=await fetch(`/api/paystack/verify?reference=${p}`),t=await e.json();if(!e.ok)throw Error(t.error||"Verification failed");if("success"===t.status){let e=t.metadata?.orderId,a=t.metadata?.paymentType||"full",r=t.amount/100;if(e)try{let t=await (0,i.getDoc)((0,i.doc)(s.db,"orders",e));if(t.exists()){let n=t.data(),o={updatedAt:i.Timestamp.now()};"deposit"===a?(o["pricing.depositPaid"]=!0,o["pricing.depositMethod"]="paystack",o["pricing.depositDate"]=i.Timestamp.now(),o["pricing.depositPaymentRef"]=p,"pending"===n.status&&(o.status="confirmed")):"balance"===a?(o["pricing.balancePaid"]=!0,o["pricing.balanceMethod"]="paystack",o["pricing.balanceDate"]=i.Timestamp.now(),o["pricing.balancePaymentRef"]=p):(o["pricing.depositPaid"]=!0,o["pricing.depositAmount"]=r,o["pricing.depositMethod"]="paystack",o["pricing.depositDate"]=i.Timestamp.now(),o["pricing.depositPaymentRef"]=p,o["pricing.balanceAmount"]=0,o["pricing.balancePaid"]=!0,"pending"===n.status&&(o.status="confirmed")),await (0,i.updateDoc)((0,i.doc)(s.db,"orders",e),o)}}catch(e){console.warn("Order update failed (webhook may have handled it):",e)}d("success"),setTimeout(()=>{o.push("/account/orders")},2e3)}else d("failed"),m("Payment was not successful")}catch(e){console.error("Verification error:",e),d("failed"),m(e instanceof Error?e.message:"Failed to verify payment")}})()},[p,o]),(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsx)("div",{className:"max-w-md w-full",children:(0,t.jsxs)("div",{className:"bg-[#111111] border border-[#1a1a1a] p-8 text-center",children:["loading"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-[#c9a962] border-t-transparent rounded-full animate-spin mx-auto mb-6"}),(0,t.jsx)("h1",{className:"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2",children:"Verifying Payment"}),(0,t.jsx)("p",{className:"text-[#888888] font-[family-name:var(--font-montserrat)]",children:"Please wait while we confirm your payment..."})]}),"success"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("h1",{className:"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2",children:"Payment Successful!"}),(0,t.jsx)("p",{className:"text-[#888888] font-[family-name:var(--font-montserrat)]",children:"Redirecting you back to your orders..."})]}),"failed"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("h1",{className:"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2",children:"Payment Verification Failed"}),(0,t.jsx)("p",{className:"text-[#888888] font-[family-name:var(--font-montserrat)] mb-6",children:l}),(0,t.jsx)(n.default,{href:"/account/orders",className:"block w-full bg-[#c9a962] text-[#0a0a0a] py-3 text-sm tracking-[0.1em] uppercase font-[family-name:var(--font-montserrat)] hover:bg-[#d4b87a] transition-colors",children:"Back to Orders"})]})]})})})}function c(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-[#c9a962] border-t-transparent rounded-full animate-spin"})}),children:(0,t.jsx)(o,{})})}e.s(["default",()=>c])}]);