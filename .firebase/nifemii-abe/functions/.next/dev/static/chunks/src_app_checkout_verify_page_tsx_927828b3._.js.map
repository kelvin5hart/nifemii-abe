{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kelvinatemie-hart/Documents/Website/nifemii-abe/src/app/checkout/verify/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { doc, updateDoc, Timestamp } from \"firebase/firestore\";\nimport { db } from \"@/lib/firebase\";\n\nfunction VerifyPaymentContent() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const [status, setStatus] = useState<\"loading\" | \"success\" | \"failed\">(\"loading\");\n  const [error, setError] = useState(\"\");\n\n  const reference = searchParams.get(\"reference\");\n  const trxref = searchParams.get(\"trxref\");\n  const paymentRef = reference || trxref;\n\n  useEffect(() => {\n    const verifyPayment = async () => {\n      if (!paymentRef) {\n        setStatus(\"failed\");\n        setError(\"No payment reference found\");\n        return;\n      }\n\n      try {\n        // Verify payment with our API\n        const response = await fetch(`/api/paystack/verify?reference=${paymentRef}`);\n        const data = await response.json();\n\n        if (!response.ok) {\n          throw new Error(data.error || \"Verification failed\");\n        }\n\n        if (data.status === \"success\") {\n          // Update order in Firestore (webhook should have done this, but as backup)\n          const orderId = data.metadata?.orderId;\n          if (orderId) {\n            try {\n              await updateDoc(doc(db, \"orders\", orderId), {\n                paymentStatus: \"paid\",\n                paymentReference: paymentRef,\n                paidAt: Timestamp.now(),\n                status: \"confirmed\",\n                updatedAt: Timestamp.now(),\n              });\n            } catch (updateError) {\n              console.warn(\"Order update failed (webhook may have handled it):\", updateError);\n            }\n          }\n\n          setStatus(\"success\");\n\n          // Redirect to success page after brief delay\n          setTimeout(() => {\n            router.push(`/checkout/success?orderId=${orderId || \"\"}&paid=true`);\n          }, 2000);\n        } else {\n          setStatus(\"failed\");\n          setError(\"Payment was not successful\");\n        }\n      } catch (err) {\n        console.error(\"Verification error:\", err);\n        setStatus(\"failed\");\n        setError(err instanceof Error ? err.message : \"Failed to verify payment\");\n      }\n    };\n\n    verifyPayment();\n  }, [paymentRef, router]);\n\n  return (\n    <div className=\"min-h-screen bg-[#0a0a0a] pt-24 pb-16 flex items-center justify-center\">\n      <div className=\"max-w-md w-full mx-4\">\n        <div className=\"bg-[#111111] border border-[#1a1a1a] p-8 text-center\">\n          {status === \"loading\" && (\n            <>\n              <div className=\"w-16 h-16 border-4 border-[#c9a962] border-t-transparent rounded-full animate-spin mx-auto mb-6\" />\n              <h1 className=\"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2\">\n                Verifying Payment\n              </h1>\n              <p className=\"text-[#888888] font-[family-name:var(--font-montserrat)]\">\n                Please wait while we confirm your payment...\n              </p>\n            </>\n          )}\n\n          {status === \"success\" && (\n            <>\n              <div className=\"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6\">\n                <svg className=\"w-8 h-8 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2\">\n                Payment Successful!\n              </h1>\n              <p className=\"text-[#888888] font-[family-name:var(--font-montserrat)]\">\n                Redirecting you to your order confirmation...\n              </p>\n            </>\n          )}\n\n          {status === \"failed\" && (\n            <>\n              <div className=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6\">\n                <svg className=\"w-8 h-8 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-[family-name:var(--font-cormorant)] text-[#f5f5f5] mb-2\">\n                Payment Verification Failed\n              </h1>\n              <p className=\"text-[#888888] font-[family-name:var(--font-montserrat)] mb-6\">\n                {error}\n              </p>\n              <div className=\"space-y-3\">\n                <Link\n                  href=\"/checkout\"\n                  className=\"block w-full bg-[#c9a962] text-[#0a0a0a] py-3 text-sm tracking-[0.1em] uppercase font-[family-name:var(--font-montserrat)] hover:bg-[#d4b87a] transition-colors\"\n                >\n                  Try Again\n                </Link>\n                <Link\n                  href=\"/shop\"\n                  className=\"block w-full border border-[#2a2a2a] text-[#888888] py-3 text-sm font-[family-name:var(--font-montserrat)] hover:border-[#3a3a3a] hover:text-[#f5f5f5] transition-colors\"\n                >\n                  Continue Shopping\n                </Link>\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function VerifyPaymentPage() {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"min-h-screen bg-[#0a0a0a] pt-24 pb-16 flex items-center justify-center\">\n          <div className=\"w-16 h-16 border-4 border-[#c9a962] border-t-transparent rounded-full animate-spin\" />\n        </div>\n      }\n    >\n      <VerifyPaymentContent />\n    </Suspense>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}