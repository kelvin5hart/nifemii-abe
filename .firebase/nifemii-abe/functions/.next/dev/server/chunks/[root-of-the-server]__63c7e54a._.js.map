{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/kelvinatemie-hart/Documents/Website/nifemii-abe/src/app/api/paystack/verify/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const reference = searchParams.get(\"reference\");\n\n    if (!reference) {\n      return NextResponse.json(\n        { error: \"Missing payment reference\" },\n        { status: 400 }\n      );\n    }\n\n    const secretKey = process.env.PAYSTACK_SECRET_KEY;\n    if (!secretKey) {\n      return NextResponse.json(\n        { error: \"Payment service not configured\" },\n        { status: 500 }\n      );\n    }\n\n    // Verify transaction with Paystack\n    const response = await fetch(\n      `https://api.paystack.co/transaction/verify/${reference}`,\n      {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${secretKey}`,\n        },\n      }\n    );\n\n    const data = await response.json();\n\n    if (!data.status) {\n      return NextResponse.json(\n        { error: data.message || \"Verification failed\" },\n        { status: 400 }\n      );\n    }\n\n    const transaction = data.data;\n\n    return NextResponse.json({\n      status: transaction.status,\n      reference: transaction.reference,\n      amount: transaction.amount / 100, // Convert from kobo to Naira\n      paid_at: transaction.paid_at,\n      channel: transaction.channel,\n      currency: transaction.currency,\n      metadata: transaction.metadata,\n      customer: {\n        email: transaction.customer?.email,\n      },\n    });\n  } catch (error) {\n    console.error(\"Error verifying payment:\", error);\n    return NextResponse.json(\n      { error: \"Failed to verify payment\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,WAAW,MAAM,MACrB,CAAC,2CAA2C,EAAE,WAAW,EACzD;YACE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,WAAW;YACtC;QACF;QAGF,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,KAAK,MAAM,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,KAAK,OAAO,IAAI;YAAsB,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,cAAc,KAAK,IAAI;QAE7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ,YAAY,MAAM;YAC1B,WAAW,YAAY,SAAS;YAChC,QAAQ,YAAY,MAAM,GAAG;YAC7B,SAAS,YAAY,OAAO;YAC5B,SAAS,YAAY,OAAO;YAC5B,UAAU,YAAY,QAAQ;YAC9B,UAAU,YAAY,QAAQ;YAC9B,UAAU;gBACR,OAAO,YAAY,QAAQ,EAAE;YAC/B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}