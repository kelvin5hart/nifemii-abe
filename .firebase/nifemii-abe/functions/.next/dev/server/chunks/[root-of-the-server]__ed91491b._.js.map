{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/kelvinatemie-hart/Documents/Website/nifemii-abe/src/app/api/paystack/initialize/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\n\ninterface InitializePaymentRequest {\n  email: string;\n  amount: number; // Amount in Naira\n  orderId: string;\n  paymentType?: \"full\" | \"deposit\" | \"balance\"; // Type of payment\n  callbackUrl?: string; // Custom callback URL\n  metadata?: {\n    customerName?: string;\n    customerPhone?: string;\n    orderItems?: string;\n  };\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: InitializePaymentRequest = await request.json();\n    const { email, amount, orderId, paymentType = \"full\", callbackUrl, metadata } = body;\n\n    // Validate required fields\n    if (!email || !amount || !orderId) {\n      return NextResponse.json(\n        { error: \"Missing required fields: email, amount, orderId\" },\n        { status: 400 }\n      );\n    }\n\n    const secretKey = process.env.PAYSTACK_SECRET_KEY;\n    if (!secretKey) {\n      console.error(\"PAYSTACK_SECRET_KEY not configured\");\n      return NextResponse.json(\n        { error: \"Payment service not configured\" },\n        { status: 500 }\n      );\n    }\n\n    // Determine callback URL\n    const baseUrl = process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\";\n    const finalCallbackUrl = callbackUrl || `${baseUrl}/checkout/verify`;\n\n    // Initialize transaction with Paystack\n    const response = await fetch(\"https://api.paystack.co/transaction/initialize\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${secretKey}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        email,\n        amount: Math.round(amount * 100), // Paystack expects amount in kobo\n        reference: `ORDER-${orderId}-${paymentType.toUpperCase()}-${Date.now()}`,\n        callback_url: finalCallbackUrl,\n        metadata: {\n          orderId,\n          paymentType,\n          custom_fields: [\n            {\n              display_name: \"Order ID\",\n              variable_name: \"order_id\",\n              value: orderId,\n            },\n            {\n              display_name: \"Payment Type\",\n              variable_name: \"payment_type\",\n              value: paymentType,\n            },\n            ...(metadata?.customerName\n              ? [\n                  {\n                    display_name: \"Customer Name\",\n                    variable_name: \"customer_name\",\n                    value: metadata.customerName,\n                  },\n                ]\n              : []),\n            ...(metadata?.customerPhone\n              ? [\n                  {\n                    display_name: \"Phone Number\",\n                    variable_name: \"customer_phone\",\n                    value: metadata.customerPhone,\n                  },\n                ]\n              : []),\n          ],\n        },\n      }),\n    });\n\n    const data = await response.json();\n\n    if (!data.status) {\n      console.error(\"Paystack initialization failed:\", data);\n      return NextResponse.json(\n        { error: data.message || \"Failed to initialize payment\" },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json({\n      authorization_url: data.data.authorization_url,\n      access_code: data.data.access_code,\n      reference: data.data.reference,\n    });\n  } catch (error) {\n    console.error(\"Error initializing payment:\", error);\n    return NextResponse.json(\n      { error: \"Failed to initialize payment\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAeO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAiC,MAAM,QAAQ,IAAI;QACzD,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,cAAc,MAAM,EAAE,WAAW,EAAE,QAAQ,EAAE,GAAG;QAEhF,2BAA2B;QAC3B,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS;YACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkD,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;QACjD,IAAI,CAAC,WAAW;YACd,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,yBAAyB;QACzB,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB,IAAI;QACnD,MAAM,mBAAmB,eAAe,GAAG,QAAQ,gBAAgB,CAAC;QAEpE,uCAAuC;QACvC,MAAM,WAAW,MAAM,MAAM,kDAAkD;YAC7E,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,WAAW;gBACpC,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA,QAAQ,KAAK,KAAK,CAAC,SAAS;gBAC5B,WAAW,CAAC,MAAM,EAAE,QAAQ,CAAC,EAAE,YAAY,WAAW,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI;gBACxE,cAAc;gBACd,UAAU;oBACR;oBACA;oBACA,eAAe;wBACb;4BACE,cAAc;4BACd,eAAe;4BACf,OAAO;wBACT;wBACA;4BACE,cAAc;4BACd,eAAe;4BACf,OAAO;wBACT;2BACI,UAAU,eACV;4BACE;gCACE,cAAc;gCACd,eAAe;gCACf,OAAO,SAAS,YAAY;4BAC9B;yBACD,GACD,EAAE;2BACF,UAAU,gBACV;4BACE;gCACE,cAAc;gCACd,eAAe;gCACf,OAAO,SAAS,aAAa;4BAC/B;yBACD,GACD,EAAE;qBACP;gBACH;YACF;QACF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,KAAK,MAAM,EAAE;YAChB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,KAAK,OAAO,IAAI;YAA+B,GACxD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,mBAAmB,KAAK,IAAI,CAAC,iBAAiB;YAC9C,aAAa,KAAK,IAAI,CAAC,WAAW;YAClC,WAAW,KAAK,IAAI,CAAC,SAAS;QAChC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}